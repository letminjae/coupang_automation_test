# 쿠팡 웹사이트 자동화 테스트

---

## 쿠팡 검색 기능 자동화 테스트 실패 과정 및 분석

본 프로젝트에서 쿠팡 웹사이트의 검색 기능에 대한 E2E 자동화 테스트를 pytest와 Selenium을 활용하여 구현하려 했습니다.
<br>
하지만 이 과정에서 강력한 봇 감지 시스템으로 인해 예상치 못한 *ERR_HTTP2_PROTOCOL_ERROR*가 발생했으며, 이를 해결하기 위한 시도와 최종적인 접근 방식을 공유합니다.

1. 문제 발생: 초기 테스트 계획은 사용자가 쿠팡 메인 페이지에 접속하여 특정 검색어를 입력하고, 검색 결과 페이지가 정상적으로 로드되는지 검증하는 것이었습니다.
<br>
로그인 기능 자동화에 성공한 후, 검색 기능을 구현하는 과정에서 문제가 발생했습니다.

    search_input.send_keys("노트북")을 통해 검색어를 입력하고 search_button.click()을 실행하자, 브라우저가 검색 결과 페이지 대신 
    <br>
    "이 웹페이지를 사용할 수 없음 - ERR_HTTP2_PROTOCOL_ERROR" 오류 페이지를 표시했습니다.
    <br>
    이는 검색 요청이 쿠팡 서버에 도달하기 전 또는 도달 직후 비정상적인 연결로 판단되어 강제로 종료되었음을 의미했습니다.

2. 실패 원인 분석: **쿠팡의 고도화된 봇 감지 시스템**
<br>
수동으로 동일한 검색 과정을 수행했을 때는 문제가 없었기 때문에, 이 오류의 직접적인 원인은 셀레니움을 통한 자동화된 접근이 쿠팡의 봇 감지 시스템에 의해 탐지되고 차단된 것으로 판단했습니다.

3. 문제 해결 시도: **셀레니움에 있는 스텔스 기능 및 인간적인 함수 구현**
<br>
봇 감지를 우회하고 검색 기능을 성공적으로 테스트하기 위해 다음과 같은 방법을 시도했습니다.

   1. **selenium-stealth 적용**: navigator.webdriver 숨기기, User-Agent 및 WebGL 정보 위장 등 기본적인 브라우저 지문 위장을 시도했습니다.
   2. **Chrome Options 설정**:
   - --start-maximized: 브라우저 창을 최대화하여 일반적인 사용자 환경을 시뮬레이션했습니다.
   - user-agent: 실제 최신 Chrome 브라우저의 User-Agent 문자열을 사용했습니다.
   - excludeSwitches 및 useAutomationExtension: 자동화 도구 사용 흔적을 숨기는 옵션을 추가했습니다.
   - --disable-blink-features=AutomationControlled: 크롬 브라우저가 자동화되고 있음을 알리는 내부 플래그를 비활성화했습니다.
   3. **인간적인 행동 시뮬레이션 함수 구현**:
    - time.sleep() 대신 random.uniform()을 활용하여 불규칙한 대기 시간을 주어 기계적인 패턴을 회피했습니다.
    - ActionChains를 활용한 마우스 이동 및 클릭(human_like_click 함수)으로 클릭 동작을 더 자연스럽게 만들려 했습니다.
    - send_keys() 대신 글자마다 불규칙한 딜레이를 주는 human_like_send_keys 함수를 구현하여 키보드 입력 속도를 조절했습니다.
    - 이러한 시도들은 로그인 과정에서는 일부 효과를 보였으나, 검색어 입력 후 검색 버튼 클릭 시 여전히 봇 감지 시스템에 의해 차단되었습니다. **이는 쿠팡의 봇 감지 시스템이 매우 정교하며, 단순히 스크립트 레벨의 위장만으로는 우회하기 어렵다는 결론에 도달하게 했습니다.**

4. 후속 조치: **테스트 코드 유지 및 결과 명시**
지속적인 봇 감지 우회 시도는 본 프로젝트의 주요 목적인 pytest와 Selenium을 활용한 E2E 자동화 테스트 코드 작성 및 학습의 효율성을 저해한다고 판단했습니다. 쿠팡의 봇 감지 시스템은 상업적인 목적의 전문적인 스크래핑 도구조차 뚫기 어려울 정도로 강력하기 때문입니다.

    따라서, 검색 기능 테스트 코드는 그대로 유지하되, 해당 테스트 케이스는 봇 감지로 인해 *ERR_HTTP2_PROTOCOL_ERROR*가 발생하는 것이 현재로서는 예상된 결과임을 명시하기로 결정했습니다.

    향후 이 프로젝트를 확장하거나 다른 웹사이트를 대상으로 할 경우, 봇 감지가 덜 강력한 웹사이트에서 보다 완벽한 E2E 테스트 흐름을 구현하거나, 봇 감지 우회 자체를 심층적으로 연구하는 별도의 프로젝트를 진행할 계획입니다.

---